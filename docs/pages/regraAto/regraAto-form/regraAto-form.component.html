<tce-breadcrumb [items]="[{text: 'Cadastro de Regras', link: '/dashboard/regraato'}, {text: pageTitle}]">
</tce-breadcrumb>
<tce-server-error-messages [server-error-messages]="serverErrorMessages"></tce-server-error-messages>

<div class="card ">
  <div class="card-body">
    <div class="card-header">
      <strong>{{pageTitle}}</strong>
    </div>
    <div class="box section-block">
      <fieldset class="withBorder">
        <legend class="withBorder">Cadastro de Regras: </legend>
        <form [formGroup]="resourceForm" (submit)="submitForm()" class="m-l-reset">
          <div class="row">
            <div class="form-group col-md-6">
              <label for="descricaoRegraAto">Descrição da Regra</label>
              <div [ngClass]="getClass('descricaoRegraAto') ? 'form-group has-success' : 'form-group has-danger'">
                <input maxlength="250" type="text" class="form-control" id="descricaoRegraAto" (change)="atualizaDescricao()"
                  formControlName="descricaoRegraAto" autocomplete="off" placeholder="Insira a descrição da regra">
                <app-form-field-error [form-control]="resourceForm.get('descricaoRegraAto')"></app-form-field-error>
              </div>
            </div>
          </div>
          <div class="row">
              <div class="form-group col-md-4">
                  <label for="idCampoRegraPre">Primeiro Campo da Regra </label>
                  <div [ngClass]="getClass('idCampoRegraPre') ? 'form-group has-success' : 'form-group has-danger'">
                    <ng-select [items]="camposRegra" bindLabel="descricaoCampoRegra" bindValue="idCampoRegra" 
                      formControlName="idCampoRegraPre" placeholder="Selecione a Regra">
                    </ng-select>
                    <app-form-field-error [form-control]="resourceForm.get('idCampoRegraPre')"></app-form-field-error>
                  </div>
              </div>
    
              <div class="form-group col-md-4">
                <label for="idOperadorAritmetico">Operador Aritmético </label>      
                <div [ngClass]="getClass('idOperadorAritmetico') ? 'form-group has-success' : 'form-group has-danger'">
                  <ng-select [items]="operadoresAritmetico" bindLabel="nomeOperadorAritmetico" bindValue="idOperadorAritmetico" (change)="atualizaDescricao()"
                    formControlName="idOperadorAritmetico" placeholder="Selecione a condição">
                  </ng-select>
                  <app-form-field-error [form-control]="resourceForm.get('idOperadorAritmetico')"></app-form-field-error>
                </div>
              </div>

              <div class="form-group col-md-4" *ngIf= "tipoSegundoCampo === 'referenciado' && (valorSegundoCampo == 'N') " >
                <label for="idCampoRegraPos">Segundo Campo da Regra</label> 
                <div [ngClass]="getClass('valorVisualizado') ? 'form-group has-success' : 'form-group has-danger'">
                  <ng-select [items]="camposRegraNumero" bindLabel="descricaoCampoRegra" bindValue="idCampoRegra" (change)="atualizaDescricao()"
                      formControlName="valorVisualizado" placeholder="Selecione o valor">
                  </ng-select>
                  <app-form-field-error [form-control]="resourceForm.get('valorVisualizado')"></app-form-field-error>
                </div>
              </div>

              <div class="form-group col-md-4" *ngIf= "tipoSegundoCampo === 'referenciado' && (valorSegundoCampo == 'D')" >
                <label for="idCampoRegraPos">Segundo Campo da Regra</label> 
                <div [ngClass]="getClass('valorVisualizado') ? 'form-group has-success' : 'form-group has-danger'">
                  <ng-select [items]="camposRegraData" bindLabel="descricaoCampoRegra" bindValue="idCampoRegra" (change)="atualizaDescricao()"
                      formControlName="valorVisualizado" placeholder="Selecione o valor">
                  </ng-select>
                  <app-form-field-error [form-control]="resourceForm.get('valorVisualizado')"></app-form-field-error>
                </div>
              </div>

              <div class="form-group col-md-4" *ngIf = "(tipoSegundoCampo === 'manual') && (valorSegundoCampo == 'N')">
                  <label for="idCampoRegraPos">Segundo Campo da Regra</label> 
                  <div [ngClass]="getClass('valorVisualizado') ? 'form-group has-success' : 'form-group has-danger'">
                      <input type="number" class="form-control" id="valorVisualizado" (change)="atualizaDescricao()"
                        formControlName="valorVisualizado" autocomplete="off" placeholder="Insira o valor">
                        <app-form-field-error [form-control]="resourceForm.get('valorVisualizado')"></app-form-field-error>
                  </div>
              </div>

              <div class="form-group col-md-4" *ngIf = "(tipoSegundoCampo === 'manual') && (valorSegundoCampo == 'D')">
                  <label for="idCampoRegraPos">Segundo Campo da Regra</label> 
                    <input type="text" class="form-control form-control-success" autocomplete="off" (change)="atualizaDescricao()"
                      formControlName="valorVisualizado" placeholder="Escolha a data"  style="background-color: white" 
                      bsDatepicker [value]="resourceForm.controls['valorVisualizado'].value | date:'DD/MM/YYYY'" />
              </div>
          </div>

          <div class="row">
            <div class="form-group col-md-6">
              <label for="idConstanteTempo">Constantes de Tempo</label>
              <div [ngClass]="getClass('idConstanteTempo') ? 'form-group has-success' : 'form-group has-danger'">
                <ng-select [items]="constantesTempoVisualizacao" bindLabel="descricaoConstanteTempo" bindValue="idConstanteTempo"
                  formControlName="idConstanteTempo" placeholder="Selecione a constante de tempo">
                </ng-select>
                <app-form-field-error [form-control]="resourceForm.get('idConstanteTempo')"></app-form-field-error>
              </div>
            </div>
            <div class="form-group col-md-2"></div>
            <div class="form-group col-md-4">
                <div class="form-group active">
                    <div class="radio-inline">
                         <label>
                            <input name="valorSegundoCampo" value="referenciado" type="radio" (click)="alteraCampoRegraPos('referenciado')" [checked]="!checkRadioManual"/>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Valor referenciado
                        </label>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <label>
                            <input name="valorSegundoCampo" value="manual" type="radio" (click) = "alteraCampoRegraPos('manual')" [checked]="checkRadioManual" />
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Valor manual
                        </label>
                    </div>
              </div>
            </div>
          </div>
          <div class="row" *ngIf="descricaoRegraAtoUsuario != null">
            <div class="form-group col-md-12">
              <strong>Regra: </strong>
              <label>{{descricaoRegraAtoUsuario}}</label>
            </div>
          </div>
          <div class="form-group col-md-10">
            <div class="form-group active pl-2">
              <input class="form-check-input ng-valid ng-dirty ng-touched" id="ativo" name="ativo" type="checkbox"
                ng-reflect-name="ativo" formControlName="ativo"> <label for="ativo">Ativo</label>
            </div>
          </div>
          <tce-buttons [actions]="actions" [disabled]="resourceForm.invalid" [clear]="false"></tce-buttons>
        </form>
      </fieldset>
    </div>
  </div>
</div>